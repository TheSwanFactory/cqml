cqml: 0.2
id: cqml_test
meta:
    org: nauto
    project: sangam
    s3.bucket: biz-databricks-root-prod-us
    catalog: quilt
    root: /dbfs/tmp
actions:
  /Workspace/Repos/ernest.prabhakar@nauto.com/cqml/data:
    do: loadfiles
    as_number: devices
    tables:
      test1: test1.csv
      test2: test2.csv
  mult_number:
    do: assign
    from: macro_run
  grouped:
    do: group
    from: test1
    agg:
      num: sum
      dat: max
    sort: max_dat
    cols:
      text: tbd
      letter: tbd
  selected:
    do: select
    from: test1
    where:
      letter:
        A: contains
        B: contains
      text:
        null: is_not
    cols:
      num: tbd
      dat: tbd
      letter: tbd
      text: tbd
  merged:
    do: merge
    save: grid
    into: test1
    join: num
    from: test2
    join_type: inner
    where:
      letter:
        A: contains
    cols:
      num: tbd
      letter|better: tbd
      dat|dot: tbd
  rename_merged:
    do: merge
    save: grid
    into: test1
    join: num
    from: test2
    join_type: inner
    where:
      letter:
        A: contains
    cols:
      num|next: tbd
      letter|better: tbd
      dat|dot: tbd
  flagged:
    do: flag
    from: test1
    where:
      text:
        null: is
  count_days:
    do: call
    from: test1
    function: datediff
    args:
        - current_date()
        - dat
  check_count:
    do: flag
    from: $id
    where:
      count_days:
  unique_num:
    do: unique
    from: test1
    sort: dat
    ensure_unique: num
    cols:
      num: tbd
  union:
    do: union
    into: test1
    from: test2
    drop:
      - note
  plus_operator:
    do: call
    from: mult_number
    operator: +
    args:
        - numerate
        - num
