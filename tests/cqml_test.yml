cqml: 0.2
id: cqml_test
meta:
    org: nauto
    project: sangam
    s3.bucket: biz-databricks-root-prod-us
    catalog: quilt
    root: /dbfs/tmp
actions:
  /Workspace/Repos/ernest.prabhakar@nauto.com/cqml/data:
    do: loadfiles
    as_number: devices
    tables:
      test1: test1.csv
      test2: test2.csv
  unique_num:
    do: unique
    from: test1
    sort: dat
    save: grid
#    ensure_unique: num
    cols:
      num: tbd
    count: [letter]
  box_details:
    do: box
    skip: true
    from: test1
    group: num
    +doc: Split by num, upload, store URLs
    box:
        root_folder: CQML_Test
        root_id: 156760265584
        data_dir: test
        file_ext: csv
        expiration_date: '2200-02-02'
    cols:
      letter: sort
      dat: sort
  widget-report:
    do: report
    from: test1
    cols:
      text: Combobox
#      num: slider
  grouped:
    do: group
    from: test1
    agg:
      num: sum
      dat: max
    sort: max_dat
    cols:
      text: tbd
      letter: tbd
  selected:
    do: select
    from: test1
    where:
      letter:
        A: contains
        B: contains
      text:
        null: is_not
    cols:
      num: tbd
      dat: tbd
      letter: tbd
      text: tbd
  merged:
    do: merge
    #save: grid
    into: test1
    join: num
    from: test2
    join_type: inner
    where:
      letter:
        A: contains
    cols:
      num: tbd
      letter|better: tbd
      dat|dot: tbd
  rename_merged:
    do: merge
    into: test1
    join: num
    from: test2
    join_type: inner
    where:
      letter:
        A: contains
    cols:
      num|next: tbd
      letter|better: tbd
      dat|dot: tbd
  flagged:
    do: flag
    from: test1
    where:
      text:
        null: is
  count_days:
    do: call
    from: test1
    function: datediff
    args:
        - current_date()
        - dat
  check_count:
    do: flag
    from: $id
    where:
      count_days:
        1: lesser
  union:
    do: union
    into: test1
    from: test2
    drop:
      - note
  plus_operator:
    do: call
    from: rename_merged
    operator: +
    args:
        - next
        - num
